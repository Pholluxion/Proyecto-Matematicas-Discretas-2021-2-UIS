<!DOCTYPE html>
<html lang="es">

<head>
    <title>Chat P2P</title>

    <link href='{{ url_for("static", filename="css/style.css") }}' rel="stylesheet" />

    <script type="text/javascript" src="//code.jquery.com/jquery-1.4.2.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
    <script type="text/javascript" charset="utf-8">
        var socket;

        $(document).ready(function () {
            socket = io.connect(
                "http://" + document.domain + ":" + location.port + "/chat"
            );
            socket.on("connect", function () {
                socket.emit("join", {});
            });

            socket.on("status", function (data) {
                $("#chat").val($("#chat").val() + "<" + data.msg + ">\n");
                $("#chat").scrollTop($("#chat")[0].scrollHeight);
            });

            socket.on("message", function (data) {
                $("#chat").val($("#chat").val() + data.msg + "\n");
                $("#chat").scrollTop($("#chat")[0].scrollHeight);
            });

            $("#send").click(function (e) {
                text = $("#text").val();
                $("#text").val("");
                socket.emit("text", { msg: text });
            });
        });
        function leave_room() {
            socket.emit("left", {}, function () {
                socket.disconnect();

                window.location.href = "{{ url_for('index') }}";
            });
        }
    </script>

    <style>
        .container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 800px;
            width: 1024;
            margin-left: 10%;
            margin-right: 10%;
            margin-top: 2%;
        }

        .messages-template {
            padding: 2%;
            padding-left: 5%;
            padding-right: 5%;
            height: 800px;
            width: 70%;
            background-color: rgb(240, 240, 240);
            border-radius: 24px;
            margin-top: 2%;
        }

        .list-users-template {
            padding: 2%;
            height: 800px;
            width: 40%;
            margin: 10px 10px 10px 10px;
            background-color: rgba(233, 233, 233, 0.411);
            border-radius: 24px;
            margin-top: 2%;
        }

        .place-holder {
            height: 70%;
            width: 100%;
            margin-top: 40px;
            background-color: rgb(223, 223, 223);
            border-radius: 24px;
        }

        .place-holder-2 {
            height: 20%;
            width: 100%;
            margin-top: 40px;
            background-color: rgb(223, 223, 223);
            border-radius: 24px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="messages-template">
            <h2>Chat en tiempo real cifrado de extremo a extremo</h2>
            <h2>Sala de chat : {{session['room']}}</h2>

            <div class="place-holder">
                <div>
                    <textarea id="chat" placeholder="No hay mensajes"></textarea>
                </div>
            </div>

            <div class="place-holder-2">
                <div>
                    <input type="text" id="text" placeholder="Nuevo mensaje" />
                    <button type="button" id="send" class="btn btn-success">
                        Enviar
                    </button>
                </div>

                <button type="button" class="btn btn-danger" onclick="leave_room()">
                    Salir de la sala
                </button>
            </div>
        </div>

        <div class="list-users-template">
            <textarea id="users"  placeholder="No hay mensajes"></textarea>
        </div>
    </div>
</body>

</html>